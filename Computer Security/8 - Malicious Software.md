# Classification of Malware
Classified into two broad categories:
- Based first on how it spreads or propagates to reach the desired targets
- then on the actions or payloads it performs once a target is reached
Also classified by:
- Those that need a host program (parasitic code such as viruses)
- Those that are independent, self-contained programs (worms, trojans, and bots)
- Malware that does not replicate (trojans and spam email)
- Malware that does replicate (viruses and worms)

# Types of Malware
Propagation mechanisms include:
- Infection of existing contents by viruses that is subsequently spread to other systems
- Exploit of software vulnerabilities by worms or drive-by-downloads to allow the malware to replicate
- Social engineering attacks that convince users to bypass security mechanisms to install Trojans or to respond to to phishing attacks

Payload actions performed by malware once it reaches a target system can include:
- Corruption of system or data files 
- Theft of service/make the system a zombie agent of attack as part of a botnet
- Theft of information from the system/keylogging 
- Stealthing/hiding its presence on the system

# Attack Kits
- Initially, the development and deployment of malware required considerable technical skill by software authors
	- the development of virus-creation toolkits in the early 1990s and then more general attack kits in the 2000s greatly assisted in the development and deployment of malware
- Toolkits are often known as "crimeware"
	- Include a variety of propagation mechanisms and payload  modules that even novices can deploy
	- variants that can be generated by attackers using these toolkits creates a significant problem for those defending systems against them
- Examples are:
	- Zeus, Angler

# Attack Sources
Another significant malware development is the change from attackers being individuals, often motivated to demonstrate their technical competence to their peers, to more organized and dangerous attack sources such as:
- political 
- criminals
- organized crime
- organizations that sell their services to companies and nations
- national government agencies 
This has significantly changed the resources available and motivation behind the rise of malware and has led to development of a large underground economy involving the sale of attack kits, access to compromised hosts, and to stolen information 


# Advanced Persistent Threats (APTs)

- Well-resourced, persistent application of a wide variety of intrusion technologies and malware to selected targets (usually business or political)
- Typically attributed to state-sponsored organizations and criminal enterprises
- Differ from other types of attack by their careful target selection and stealthy  intrusion efforts over extended periods 
- High profile attacks include Aurora, RSA, APT1, and Stuxnet

# APT characteristics
Advanced
- Used by the attackers of a wide variety of intrusion technologies and malware including the development of custom malware, if required 
- The individual components may not necessarily be technically advanced but are carefully selected to suit the chosen target
Persistent 
- Determined application of the attacks over an extended period against the chosen target in order to maximize the chance of success 
- A variety of attacks may be progressively applied until the target is compromised 
Threats 
- Threats to the selected targets as a result of the organized, capable, and well-funded attackers intent to compromise the specifically chosen targets
- The active involvement of people in the process greatly raises the threat level from that due to automated attacks tools, and also the likelihood of successful attacks 

# APT Attacks
- Aim:
	- Varies from theft of intellectual property or security and infrastructure related data to the physical disruption of infrastructure
- Techniques used:
	- Social engineering
	- Spear-phishing email 
	- Drive-by-downloads from selected compromised websites likely to be visited by personnel in the target organization
- Intent:
	- To infect the target with sophisticated malware with multiple propagation mechanisms and payloads 
	- Once they have gained initial access to systems in the target organization a further range of attack tools are used to maintain and extend their access

# Viruses
- Piece of software that infects programs 
	- modifies them to include a copy of the virus
	- replicates and goes on to infect other content 
	- easily spread through network environments 
- When attached to an executable program a virus can do anything that program is permitted to do 
	- executes secretly when the host program is run
- Specific to operating system and hardware
	- takes advantage of their details and weaknesses


# Virus Components 
Infection mechanism
- Means by which a virus spread or propagates
- Also referred to as the infection vector
Triggger
- Event or condition that determines when the payload is activated or delivered
- Sometimes know as a logic bomb
Payload
- What the virus does (besides spreading)
- May involve damage or benign but noticeable activity

# Virus Phases
Dormant phase
- Virus is idle
- Will eventually be activated by some event
- not all viruses have this stage
Triggering phase
- Virus is activated to perform the function for which is intended
- Can be caused by a variety of system events
Propagation phase
- Virus places a copy of itself into other programs or into certain system areas on the disk
- May not be identical to the propagating version
- Each infected program will now contain a clone of the virus which will itself enter a propagation phase
Execution phase
- Function is performed
- may be harmless or damaging

Macro and Scripting Viruses
- NISTIR 7298 defines a macro virus as:
	- "a virus that attaches itself to documents and uses the macro programming capabilities of the document's application to execute and propagate"
- Macro viruses infect scripting code used to support active content in a variety of user document types
- Are threatening for a number of reasons:
	- Is platform independent
	- Infect documents, not executable portions of code
	- Area easily spread
	- Because they infect user documents rather than system programs, traditional file system access controls are of limited use in preventing their spread, since users are expected to modify them
	- Are much easier to write or modify than traditional executable viruses

# Virus Classifications 
Classification by target
- Boot sector infector
	- Infects a master boot record or boot record and spreads when a system is booted from the disk containing the virus
- File infector
	- Infects files that the operating system or shell considers to be executable 
- Macro virus 
	- Infects files with macro or scripting code that is interpreted by an application
- Multipartite virus
	- Infects files in multiple ways

Classification by concealment strategy
- Encrypted virus
	- A portion of the virus creates random encryption key and encrypts the remainder of the virus
- Stealth virus
	- A form of virus explicitly designed to hide itself from detection by anti-virus software
- Metamorphic virus
	- A virus that mutates and rewrites itself completely at each iteration and may change behavior as well as appearance 


# Worms
- Program that actively seeks out more machines to infect and each infected machine serves as an automated launching pad for attacks on other machines
- Exploits software vulnerabilities in client or server programs 
- can use network connections to spread from system to system
- E-mail worms spread in macro or script code included in attachments and instant messenger file transfers
- Upon activation the worm may replicate and propagate again 
- Usually carries some form of payload
- First know implementation was done in Xerox Palo Alto Labs in the early 1980s

# Worm Replication 
Electronic mail or instant messenger facility
- Worm emails a copy of itself to other systems 
- Sends itself as an attachment via an instant message service
File sharing
- Creates a copy of itself or infects a file as a virus on removable media
Remote execution capability 
- Worm executes a copy of itself on another system
Remote file access or transfer capability 
- Worm uses a remote file access or transfer service to copy itself from one system to the other
Remote login capability 
- Worm logs onto a remote system as a user and then uses commands to copy itself from the one system to the other

# Target Discovery 
Scanning (or fingerprinting)
- First function in the propagation phase for a network worm
- Searches for other systems to infect
Random
- Each compromised host probes random addresses in the IP address space using a different seed
- This produces a high volume of internet traffic which may cause generalized disruption even before the actual attack is launched
Hit-list
- The attacker firs compiles a long list of potential vulnerable machines 
- Once the list is compiled the attacker begins infecting machines on the list 
- Each infected machine is provided with a portion of the list to scan
- This results in a very short scanning period which may make it difficult to detect that infection is taking place
Topological 
- This method uses information contained on an infected victim machine to find more hosts to scan
Local subnet
- If a host can be infected behind a firewall that host, then looks for targets in its own local network 
- The host uses the subnet address structure to find other hosts that would otherwise be protected by the firewall

# Drive-By-Downloads
Exploits browser and plugin vulnerabilities so when the user views a webpage controlled by the attacker, it contains code that exploits the bug to download and install malware on the system without user's knowledge or consent. 

In most cases, the malware does not actively propagate as a worm does 

Spreads when users visit the malicious web page

# Watering-Hole Attacks
- A variant of drive-by-download used in highly targeted attacks 
- The attacker researches their intended victims to identify websites they are likely to visit, then scans these sites to identify those with vulnerabilities that allow their compromise 
- Attack code may even be written so that it will only infect systems belonging to the target organizations and take no action for other visitors to the site
- This greatly increases the likelihood of the site compromise remaining undetected

# Malvertising 
- Places malware on websites without compromising them 
- The attacker pays for advertisements that are highly likely to be placed on their intended target websites and incorporate malware in them 
- Suing these malicious ads, attackers can infect visitors to sites displaying them
- The malware code may be dynamically generated to either reduce the chance of detection or to only infect specific systems
- Has grown rapidly in recent years because they are easy to place on desired websites with few questions asked and are hard to track
- Attackers can place these ads for as little as few hours, when they expect their intended victims could be browsing the targeted websites, greatly reducing their visibility 

# Clickjacking
- Also known as user-interface redress attack 
- A user is manipulated into typing in the password into an invisible frame controlled by the attacker 
	- Using a similar technique, keystrokes can also be hijacked
- Vulnerability to collect user's clicks 
	- user is forced to do a variety of things from adjusting the user's computer settings to unwittingly sending the user to web sites that might have malicious code
	- By taking advantage of adobe flash or javascript an attacker could even place a button under or over a legitimate button making it difficult for users to detect
	- A typical attack uses multiple transparent or opaque layers to trick a user into clicking on a button or link on another page when they were intending to clik on the top-level page
	- The attacker is hijacking clicks meant for one page and routing them to another page

# Social Engineering
Spam
- unsolicited bulk email
- significant carrier of malware
- used for phishing attacks
Trojan horse
- program or utility containing harmful hidden code
- used to accomplish functions that the attacker could not accomplish directly

# Payload - Attack Agents (BOTS)
- takes over another internet attached computer and uses that computer to launch or manage attacks
- botnet  - collection of bots capable of acting in a coordinated manner 
- uses:
	- ddos
	- spamming
	- keylogging
	- spreading new malware
	- installing advertisement add-ons and browser helper objects (BHOs)
	- attacking IRC chat networks 
	- manipulating online polls/games

# Remote Control Facility
- Distinguishes a bot from a worm
	- Worm propagates and activates itself 
	- bot is initially controlled from some central facility 
- Typically means of implementing the remote-control facility is on an IRC server
	- Bots join a specific channel on this server and treat incoming message as commands
	- more recent botnets use covert communication channels via protocols such as http
	- distributed control mechanisms user peer-to-peer protocols to avoid a single point of failure
- One effective counter measure against a botnet is to take-over or shutdown its command-and-control server network


# Payload - Information Theft 
Keylogger
Spyware
- subverts the compromised machine to allow monitoring of a wide range of activity on the system
- monitoring history and content of browsing activity
- redirecting web requests to fake sites
- dynamically modifying data exchanged between the browser and certain web sites of  interest

# Payload - Stealthing (Backdoor)
- Also known as a trapdoor
- secret entry point into a program allowing the attacker to gain access and bypass the security access procedures 
- maintenance hook is a backdoor used by programmers to debug and test programs 
- difficult to implement operating system controls for backdoors in applications 

# Payload - Stealthing (Rootkit)
- set of hidden programs installed on a system to maintain covert access to the system
- hides by subverting the mechanisms that monitor and report on the processes, files, and registries on a computer
- gives administrator (or root) privileges to attacker
	- can add or change programs and files, monitor processes, send and receive network traffic, and get backdoor access on demand

# Rootkit Classification Characteristics 
- Persistent 
- Memory baesd
- user mode
- kernel mode
- virtual machine based
- external mode

# Malware Countermeasure Approaches
- Ideal solution to the threat of malware is prevention
Four main elements of prevention:
- Policy 
- Awareness
- vulnerability mitigation 
- threat mitigation

if prevention fails, technical mechanisms can be used to support the following threat mitigation options: detection, identification, removal

# Generations of Anti-Virus Software
First: simple scanners
- requires malware signature to identity the malware
- limited to the detection of known malware
Second: heuristic scanners
- uses heuristic rules to search for probable malware instances 
- another approach is integrity checking
Third: activity traps
- memory-resident programs that identity malware by its actions rather than its structure in an infected program 
Fourth: full-featured protection
- includes scanning, activity trap, access control capability

# Sandbox Analysis
- Running potentially malicious code in an emulated sandbox or on a virtual machine
- allows the code to execute in a controlled environment where its behavior can be closely monitored without threatening the security of a real system
- running potentially malicious software in such environments enables the detection of complex encrypted, polymorphic, or metamorphic malware
- the most difficult design issue with sandbox analysis is to determine how long to run each interpretation 
# Host-Based Behavior-Blocking Software
- It is a type of host-based intrusion prevention system
- Integrates with the operating system of a host computer and monitors program behavior in real time for malicious action 
	- blocks potentially malicious actions before they have a chance to affect the system
	- blocks software in real time so it has an advantage over anti-virus detection techniques such as fingerprinting or heuristics
Limitations:
	Because malicious code must run on the target machine before all its behaviors can be identified, it can cause harm before it has been detected and blocked

# Perimeter Scanning Approaches
- Anti-virus software typically included in email and web proxy services running on an organizations firewall and IDS
- May also be included in the traffic analysis component of an IDS
- May include intrusion prevention measures, blocking the flow of any suspicious traffic
- Approach is limited to scanning malware
Ingress monitors
	located at the border between the enterprise network and the internet 
	one technique is to look for incoming traffic to unused local IP addresses 
Engress monitors
	located at the egress point of individual LANs as well as the border between the enterprise network and the internet
	monitors outgoing traffic for sings of scanning or other suspicious behavior
	







































